name: hello-world
on: push

env:
  SPECTRAL_DSN: https://spu-e547a47732c946f7b8a1c951e459b845@get.spectralops.io

jobs:
  scan:
    runs-on: ubuntu-latest
    permissions:    
      security-events: write      
      actions: read
      contents: read
    steps:
      - uses: actions/checkout@v3
        with: 
          fetch-depth: 0
      - run: git diff --name-only ${{ github.event.before }} ${{ github.sha }}
      - name: Install and run Spectral CI
        uses: spectralops/spectral-github-action@v3
        with:
          spectral-dsn: https://spu-e547a47732c946f7b8a1c951e459b845@get.spectralops.io
          spectral-args: scan --include-tags base,audit --json-v2 results.json --ok     
      - name: Run npm install
        run: npm install
      # Runs the ESlint code analysis
      - name: Run ESLint
        # eslint exits 1 if it finds anything to report        
        run: node_modules/.bin/eslint --format sarif results.json --output-file results.sarif
      # Uploads results.sarif to GitHub repository using the upload-sarif action
      - uses: github/codeql-action/upload-sarif@v2
        with:
          # Path to SARIF file relative to the root of the repository
          sarif_file: results.sarif
      - name: Upload SARIF file
        uses: github/codeql-action/upload-sarif@v2
        with:
          # Path to SARIF file relative to the root of the repository
          sarif_file: results.sarif
          # Optional category for the results
          # Used to differentiate multiple results for one commit
          category: my-analysis-tool  
